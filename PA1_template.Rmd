---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

The data should be placed in */home/remco/Desktop/data/* folder to work.
For processing I also import some libraries.

```{r load_data}

library(lubridate)
library(stringr)
library(dplyr)
library(lattice)

d <- read.csv("/home/remco/Desktop/data/activity.csv")

```

Adding *datetime* and *day* values. The latter will be used to distinguish weekdays (Monday-Friday) from weekend-days (Saturday and Sunday).

```{r adding_datetime_values}
d$datetime      <- ymd_hm(paste(d$date, str_pad(d$interval,4, pad="0"), sep=" "))
d$day           <- wday(d$datetime)
d               <- mutate(d, day = factor(1*(day==1|day==7), labels=c("weekday","weekend")))
```

Get a short overview of the data.frame to see what's in there.

```{r check_frame}
str(d)
```




## What is mean total number of steps taken per day?

Now grouping over *date* value in order to calculate the total number of steps
per day. A histogram is created to plot the frequency against number of steps.

```{r steps_per_day}

days            <- group_by(d, date)
steps_per_day   <- summarize(days, total_steps = sum(steps, na.rm=TRUE))
hist(steps_per_day$total_steps, breaks=30, col="blue", 
     xlab="number of steps per day",
     main="")

mean_value      <- mean(steps_per_day$total_steps, na.rm=TRUE)
median_value    <- median(steps_per_day$total_steps, na.rm=TRUE)
```

It follows that  *mean_value*=`r mean_value` and *median_value*=`r median_value`. 




## What is the average daily activity pattern?

In order to retrieve the average daily activity pattern we need to group by *interval*, thereby summarizing over equal intervals of all recorded dates. The resulting pattern
is plotted using *xyplot*.

```{r daily_activity}

intervals       <- group_by(d, interval)
activity        <- summarize(intervals, steps = mean(steps, na.rm=TRUE))

with(activity, xyplot( steps ~ interval, type="l", col="blue", 
                       lwd=2, main="Daily activity pattern"))

```

The top three intervals in terms of activity (number of steps), looks as follows:

```{r most_activity}

head( arrange( activity, -steps) , 3 )

```



## Imputing missing values


**1.** We make a new dataset to get an overview of all the <NA> values are in the data.frame. By summing over the columns (this can be done as TRUE is evaluated to numeric 1, FALSE to 0) we see how many values are missing per column.

```{r counting_missing}

na      <- is.na( d )
na_sum  <- apply( na , 2 , sum )
na_sum

```

It follows that only the *steps* value has missing values, this should not come as a surprise as this is the only measurement! A total number of `r na_sum[1]` measurements
are missing.

**2.** Though missing values could correspond with inactivity, and therefore a count of 0 zero steps, the large number of such missing values makes it more likely they are caused by some malfunctioning of the device. In the code below the missing *steps* values are replaced by the average number of steps for identical intervals. We will first create a new dataset, copying the contents of the original ones (including processing of that original dataset), and then fill in missing values. 

```{r filling_missing}

d_filled <- d

for(i in 1:dim(d_filled)[1]){
        if(is.na(d_filled[i,]$steps)){
                d_filled[i,]$steps <- activity[activity$interval==d_filled[i,]$interval,]$steps
        }
}

str(d_filled)


```
## Are there differences in activity patterns between weekdays and weekends?

```{r weekend-week-patterns}

day_interval <- group_by(d_filled, day, interval)
head(day_interval)
spd <- summarize(day_interval, steps = mean(steps))


with(spd, xyplot(steps ~ interval | day, type="l",layout=c(1,2)))

```